# 第 6 天教学讲义（约 20 分钟）

> 主题：现状评估与改进待办 —— 密码复杂度、登录审计、网关治理

## 今日目标
- 结合《网关与登录服务最佳实践评估报告》理解已完成与待改进项。
- 明确三大待办：密码复杂度校验、登录审计日志、网关限流/熔断。
- 给出落地思路，便于后续实践。

## 节奏（20 分钟）
1. 5 分钟：报告要点回顾。
2. 10 分钟：三大待办的实现思路。
3. 5 分钟：选择一个小目标准备 Day7 动手。

## 报告要点（速读）
- 已完成：双 Token、黑名单、刷新、登出、单点登录；TraceId；统一异常/错误码；网关鉴权透传。  
- 待改进：网关治理（限流/熔断/重试）、登录审计表、密码复杂度校验、文档补充。

## 三大待办——实现思路
1) 密码复杂度校验  
   - 规则示例：长度 ≥ 8，包含大小写字母、数字、特殊字符。  
   - 落点：注册/修改密码/登录前校验（至少在注册与改密时）。  
   - 与错误码：`PWD_WEAK(1017)` 已有，可复用。
2) 登录审计日志  
   - 新表（可命名 `login_audit_log`）：user_id、username、结果(success/fail)、ip、user_agent、终端、失败原因、时间。  
   - 写入时机：登录成功/失败时各记录一次；可异步（MQ/线程池）或同步简单插入。  
   - 查询：按用户/时间/结果过滤，便于安全审计。
3) 网关治理（限流/熔断/重试）  
   - 限流：Spring Cloud Gateway `RedisRateLimiter`，按路由/服务配置。  
   - 熔断：结合 Resilience4j/Spring Cloud CircuitBreaker，对下游异常快速失败。  
   - 重试：Gateway Retry 过滤器，针对幂等 GET 场景；谨慎使用。

## 选一个小目标准备明天
- 建议选“密码复杂度校验”或“登录审计表”作为 Day7 小练习。  
- 若选网关限流，可先挑一个路由用最小限流配置试跑。

## 课后巩固
- 让她写出密码复杂度的正则或伪代码。  
- 画一个简单 ER 图：`login_audit_log` 需要哪些字段。  
- 思考限流配置放在哪个路由、阈值怎么定。


