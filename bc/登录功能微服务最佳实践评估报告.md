# ç™»å½•åŠŸèƒ½å¾®æœåŠ¡æœ€ä½³å®è·µè¯„ä¼°æŠ¥å‘Š

## ğŸ“Š æ€»ä½“è¯„ä»·

**å½“å‰çŠ¶æ€ï¼š** â­â­â­âœ¨â˜† (3.4/5)  
**ç¬¦åˆåº¦ï¼š** åŸºç¡€åŠŸèƒ½å®Œæ•´ï¼Œæ–°å¢ Redis é©±åŠ¨çš„ç™»å½•å¤±è´¥é˜²æŠ¤ï¼Œä½†ä»ç¼ºä¹å¤šç»´åº¦é£æ§ã€æ—¥å¿—ä¸ Token ç®¡ç†ç­‰å¾®æœåŠ¡å…³é”®èƒ½åŠ›

**ä¸Šæ¬¡è¯„ä¼°æ—¥æœŸï¼š** 2025-11-08  
**æœ¬æ¬¡æ›´æ–°æ—¥æœŸï¼š** 2025-11-10ï¼ˆé‡æ–°æ£€æŸ¥ï¼‰

---

## âœ… å·²å®ç°çš„ä¼˜ç§€å®è·µ

### 1. **æ¶æ„è®¾è®¡**
- âœ… **åˆ†å±‚æ¸…æ™°**ï¼šControllerã€Serviceã€Mapper ä¸‰å±‚åˆ†ç¦»
- âœ… **DTO/VOåˆ†ç¦»**ï¼šä½¿ç”¨ LoginDto å’Œ LoginVo è¿›è¡Œæ•°æ®ä¼ è¾“
- âœ… **æ¥å£è®¾è®¡**ï¼šRESTful API è®¾è®¡è§„èŒƒ
- âœ… **ç»Ÿä¸€å“åº”**ï¼šä½¿ç”¨ Response ç»Ÿä¸€å“åº”æ ¼å¼
- âœ… **ç»Ÿä¸€å¼‚å¸¸å¤„ç†**ï¼šGlobalExceptionHandler å…¨å±€å¼‚å¸¸æ•è·

### 2. **å®‰å…¨æ€§**
- âœ… **å¯†ç åŠ å¯†**ï¼šä½¿ç”¨ BCrypt è¿›è¡Œå¯†ç åŠ å¯†å­˜å‚¨
- âœ… **JWTè®¤è¯**ï¼šä½¿ç”¨ JWT Token è¿›è¡Œæ— çŠ¶æ€è®¤è¯
- âœ… **å‚æ•°éªŒè¯**ï¼šä½¿ç”¨ @Valid å’Œ @NotBlank è¿›è¡Œå‚æ•°æ ¡éªŒ
- âœ… **è´¦å·çŠ¶æ€æ£€æŸ¥**ï¼šæ£€æŸ¥è´¦å·æ˜¯å¦ç¦ç”¨ã€é”å®š
- âœ… **ç™»å½•å¤±è´¥é˜²æŠ¤**ï¼š`AuthServiceImpl` + `LoginSecurityService` ä½¿ç”¨ Redis è®°å½•å¤±è´¥æ¬¡æ•°å¹¶è‡ªåŠ¨é”å®šè´¦å·
- âœ… **é…ç½®å¤–éƒ¨åŒ–**ï¼šJWT å¯†é’¥å’Œè¿‡æœŸæ—¶é—´ä» Nacos é…ç½®ä¸­å¿ƒè¯»å–

### 3. **ä»£ç è´¨é‡**
- âœ… **é”™è¯¯ç è®¾è®¡**ï¼šç»Ÿä¸€çš„é”™è¯¯ç æšä¸¾
- âœ… **é”™è¯¯ç æ‰©å±•**ï¼šå·²å¢åŠ é™æµç›¸å…³é”™è¯¯ç ï¼ˆRATE_LIMIT_EXCEEDED, QUOTA_EXCEEDEDï¼‰
- âœ… **Swaggeræ–‡æ¡£**ï¼šAPI æ–‡æ¡£å®Œæ•´
- âœ… **ä»£ç æ³¨é‡Š**ï¼šå…³é”®æ–¹æ³•æœ‰æ³¨é‡Šè¯´æ˜
- âœ… **å¼‚å¸¸å¤„ç†ä¼˜åŒ–**ï¼šGlobalExceptionHandler å·²ä¼˜åŒ–ï¼Œæ›´ç²¾ç¡®åœ°å¤„ç†å‚æ•°éªŒè¯å¼‚å¸¸

### 4. **åŸºç¡€è®¾æ–½å‡†å¤‡** ğŸ†•
- âœ… **Redis ä¾èµ–**ï¼šå·²åœ¨ `mms-usercenter-bc/pom.xml` ä¸­æ·»åŠ  Redis ä¾èµ–
- âœ… **Redis ä½¿ç”¨**ï¼š`LoginSecurityService` æ³¨å…¥ `RedisTemplate`ï¼Œç”¨äºç™»å½•å¤±è´¥è®¡æ•°ä¸è´¦å·é”å®š

---

## âŒ ç¼ºå¤±çš„å…³é”®åŠŸèƒ½ï¼ˆå¾®æœåŠ¡æœ€ä½³å®è·µï¼‰

### 1. **å®‰å…¨æ€§å¢å¼º** ğŸ”´ é«˜ä¼˜å…ˆçº§

#### 1.1 ç™»å½•å¤±è´¥æ¬¡æ•°é™åˆ¶å’Œé˜²æš´åŠ›ç ´è§£
**ç°çŠ¶ï¼š** å·²æ–°å¢ `LoginSecurityConfig`ã€`LoginSecurityService`ï¼Œé€šè¿‡ Redis è®°å½•ç”¨æˆ·ç™»å½•å¤±è´¥æ¬¡æ•°å¹¶è‡ªåŠ¨é”å®šè´¦å·ï¼ˆé»˜è®¤ 5 æ¬¡ï¼Œé”å®š 30 åˆ†é’Ÿï¼‰ã€‚ä»ç¼ºå°‘ IP ç»´åº¦ã€æ»‘åŠ¨çª—å£é™æµä¸éªŒè¯ç è”åŠ¨ã€‚

**åç»­å»ºè®®ï¼š**
- æŒ‰ IP åœ°å€/è®¾å¤‡ç»´åº¦è®°å½•å¤±è´¥æ¬¡æ•°ï¼Œé˜²æ­¢åˆ†å¸ƒå¼æ”»å‡»
- æ‰©å±•æ»‘åŠ¨æ—¶é—´çª—å£é™æµï¼ˆå¦‚ 5 åˆ†é’Ÿå†… 5 æ¬¡ï¼‰
- ä¸éªŒè¯ç è”åŠ¨ï¼Œåœ¨é«˜é£é™©æ—¶è§¦å‘éªŒè¯ç æˆ–äºŒæ¬¡éªŒè¯

#### 1.2 ç™»å½•æ—¥å¿—è®°å½•
**é—®é¢˜ï¼š** æ•°æ®åº“ä¸­æœ‰ `sys_user_login_log` è¡¨ï¼Œä½†ä»£ç ä¸­æ²¡æœ‰å®ç°æ—¥å¿—è®°å½•

**å»ºè®®å®ç°ï¼š**
- è®°å½•ç™»å½•æˆåŠŸ/å¤±è´¥æ—¥å¿—
- è®°å½•ç™»å½• IPã€åœ°ç†ä½ç½®ã€User-Agent
- å¼‚æ­¥è®°å½•æ—¥å¿—ï¼Œé¿å…å½±å“ç™»å½•æ€§èƒ½

#### 1.3 Token åˆ·æ–°æœºåˆ¶
**é—®é¢˜ï¼š** åªæœ‰ Access Tokenï¼Œç¼ºå°‘ Refresh Token æœºåˆ¶

**å»ºè®®å®ç°ï¼š**
- å®ç° Access Tokenï¼ˆçŸ­è¿‡æœŸæ—¶é—´ï¼Œå¦‚2å°æ—¶ï¼‰
- å®ç° Refresh Tokenï¼ˆé•¿è¿‡æœŸæ—¶é—´ï¼Œå¦‚7å¤©ï¼‰
- æä¾› Token åˆ·æ–°æ¥å£

#### 1.4 Token é»‘åå•ï¼ˆç™»å‡ºåŠŸèƒ½ï¼‰
**é—®é¢˜ï¼š** æ²¡æœ‰ç™»å‡ºåŠŸèƒ½ï¼ŒToken æ— æ³•ä¸»åŠ¨å¤±æ•ˆ

**å»ºè®®å®ç°ï¼š**
- ç™»å‡ºæ—¶å°† Token åŠ å…¥ Redis é»‘åå•
- ç½‘å…³å±‚éªŒè¯ Token æ—¶æ£€æŸ¥é»‘åå•
- æ”¯æŒ Token ä¸»åŠ¨å¤±æ•ˆ

#### 1.5 æœ€åç™»å½•ä¿¡æ¯æ›´æ–°
**é—®é¢˜ï¼š** ä»£ç ä¸­æ›´æ–°æœ€åç™»å½•æ—¶é—´å’ŒIPçš„ä»£ç è¢«æ³¨é‡Šæ‰äº†

**å»ºè®®å®ç°ï¼š**
- ç™»å½•æˆåŠŸåæ›´æ–°æœ€åç™»å½•æ—¶é—´å’ŒIP
- è®°å½•å®¢æˆ·ç«¯ IP åœ°å€ï¼ˆä»è¯·æ±‚å¤´è·å–ï¼‰

---

### 2. **æ€§èƒ½ä¼˜åŒ–** ğŸŸ¡ ä¸­ä¼˜å…ˆçº§

#### 2.1 Redis ç¼“å­˜
**çŠ¶æ€ï¼š** ğŸŸ¡ **å·²å¯ç”¨ç™»å½•å®‰å…¨ç›¸å…³ç¼“å­˜ï¼Œå…¶ä»–ç”¨é€”å¾…è¡¥å……**

**ç°çŠ¶ï¼š**
- âœ… é€šè¿‡ `RedisTemplate` å®ç°ç™»å½•å¤±è´¥è®¡æ•°å’Œè´¦å·é”å®š
- âŒ å°šæœªç¼“å­˜ç”¨æˆ·ä¿¡æ¯/Token/é»‘åå•

**å»ºè®®ï¼š**
- ç¼“å­˜ç”¨æˆ·åŸºç¡€ä¿¡æ¯ï¼Œå‡å°‘é‡å¤æŸ¥è¯¢
- åˆ©ç”¨ Redis ç®¡ç† Token é»‘åå•ä¸åˆ·æ–°ä»¤ç‰Œ
- ç»“åˆ Redis å®ç°ç™»å½•è¡Œä¸ºåˆ†æ

#### 2.2 æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
**é—®é¢˜ï¼š** `selectByUsername` åªæŸ¥è¯¢äº†éƒ¨åˆ†å­—æ®µï¼Œä½†å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–

**å»ºè®®ï¼š**
- å½“å‰å®ç°å·²ç»å¾ˆå¥½ï¼ˆåªæŸ¥è¯¢å¿…è¦å­—æ®µï¼‰
- å¯ä»¥è€ƒè™‘æ·»åŠ ç´¢å¼•ä¼˜åŒ–ï¼ˆusername å·²æœ‰å”¯ä¸€ç´¢å¼•ï¼‰

---

### 3. **å¯è§‚æµ‹æ€§** ğŸŸ¡ ä¸­ä¼˜å…ˆçº§

#### 3.1 ç™»å½•æ—¥å¿—
**é—®é¢˜ï¼š** ç¼ºå°‘ç™»å½•æ—¥å¿—è®°å½•ï¼Œæ— æ³•è¿½è¸ªç™»å½•è¡Œä¸º

**å»ºè®®å®ç°ï¼š**
- è®°å½•ç™»å½•æˆåŠŸ/å¤±è´¥æ—¥å¿—åˆ°æ•°æ®åº“
- è®°å½•ç™»å½• IPã€åœ°ç†ä½ç½®ã€User-Agent
- æ”¯æŒç™»å½•æ—¥å¿—æŸ¥è¯¢å’Œç»Ÿè®¡åˆ†æ

#### 3.2 ç›‘æ§å’Œå‘Šè­¦
**é—®é¢˜ï¼š** ç¼ºå°‘ç™»å½•ç›¸å…³çš„ç›‘æ§æŒ‡æ ‡

**å»ºè®®å®ç°ï¼š**
- ç™»å½•æˆåŠŸç‡ç›‘æ§
- ç™»å½•å¤±è´¥æ¬¡æ•°ç›‘æ§
- å¼‚å¸¸ç™»å½•è¡Œä¸ºå‘Šè­¦ï¼ˆå¦‚å¼‚åœ°ç™»å½•ï¼‰

---

### 4. **ç½‘å…³å±‚è®¤è¯** ğŸ”´ é«˜ä¼˜å…ˆçº§

#### 4.1 ç½‘å…³ç»Ÿä¸€è®¤è¯
**é—®é¢˜ï¼š** ç½‘å…³å±‚ç¼ºå°‘ JWT Token éªŒè¯

**å»ºè®®å®ç°ï¼š**
- åœ¨ç½‘å…³å±‚å®ç° JWT Token éªŒè¯è¿‡æ»¤å™¨
- ç»Ÿä¸€å¤„ç†è®¤è¯å¤±è´¥å“åº”
- æ”¯æŒç™½åå•ï¼ˆå¦‚ç™»å½•æ¥å£ä¸éœ€è¦è®¤è¯ï¼‰

#### 4.2 é™æµä¿æŠ¤
**é—®é¢˜ï¼š** ç™»å½•æ¥å£ç¼ºå°‘é™æµä¿æŠ¤

**å»ºè®®å®ç°ï¼š**
- ä½¿ç”¨ç½‘å…³é™æµï¼ˆå¦‚ Spring Cloud Gateway RateLimiterï¼‰
- æŒ‰ IP é™åˆ¶ç™»å½•æ¥å£è°ƒç”¨é¢‘ç‡
- é˜²æ­¢æ¥å£è¢«æ¶æ„è°ƒç”¨

---

### 5. **åŠŸèƒ½å®Œæ•´æ€§** ğŸŸ¡ ä¸­ä¼˜å…ˆçº§

#### 5.1 ç™»å‡ºæ¥å£
**é—®é¢˜ï¼š** åªæœ‰ç™»å½•æ¥å£ï¼Œç¼ºå°‘ç™»å‡ºæ¥å£

**å»ºè®®å®ç°ï¼š**
- å®ç°ç™»å‡ºæ¥å£
- å°† Token åŠ å…¥é»‘åå•
- æ¸…é™¤ç›¸å…³ç¼“å­˜

#### 5.2 Token åˆ·æ–°æ¥å£
**é—®é¢˜ï¼š** ç¼ºå°‘ Token åˆ·æ–°æ¥å£

**å»ºè®®å®ç°ï¼š**
- å®ç° Token åˆ·æ–°æ¥å£
- æ”¯æŒ Refresh Token åˆ·æ–° Access Token
- åˆ·æ–°æ—¶éªŒè¯ Token æœ‰æ•ˆæ€§

---

## ğŸ“‹ æ”¹è¿›å»ºè®®ä¼˜å…ˆçº§

### ğŸ”´ P0 - å¿…é¡»ç«‹å³å®ç°ï¼ˆå®‰å…¨æ€§ï¼‰
1. **ç™»å½•å¤±è´¥æ¬¡æ•°é™åˆ¶å’Œé˜²æš´åŠ›ç ´è§£**
2. **ç™»å½•æ—¥å¿—è®°å½•**
3. **ç½‘å…³å±‚ JWT è®¤è¯**
4. **Token é»‘åå•ï¼ˆç™»å‡ºåŠŸèƒ½ï¼‰**

### ğŸŸ¡ P1 - å»ºè®®å°½å¿«å®ç°ï¼ˆåŠŸèƒ½å®Œæ•´æ€§ï¼‰
5. **Token åˆ·æ–°æœºåˆ¶**
6. **æœ€åç™»å½•ä¿¡æ¯æ›´æ–°**
7. **Redis ç¼“å­˜é›†æˆ**

### ğŸŸ¢ P2 - å¯ä»¥åç»­å®ç°ï¼ˆä¼˜åŒ–ï¼‰
8. **ç›‘æ§å’Œå‘Šè­¦**
9. **ç™»å½•åœ°ç†ä½ç½®è¯†åˆ«**
10. **ç™»å½•è¡Œä¸ºåˆ†æ**

---

## ğŸ¯ å¾®æœåŠ¡æœ€ä½³å®è·µç¬¦åˆåº¦

| å®è·µé¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| æ— çŠ¶æ€è®¤è¯ | âœ… | ä½¿ç”¨ JWTï¼Œç¬¦åˆæ— çŠ¶æ€è®¤è¯ |
| å¯†ç åŠ å¯† | âœ… | ä½¿ç”¨ BCryptï¼Œç¬¦åˆå®‰å…¨æ ‡å‡† |
| å‚æ•°éªŒè¯ | âœ… | ä½¿ç”¨ @Validï¼Œç¬¦åˆè§„èŒƒ |
| ç»Ÿä¸€å¼‚å¸¸å¤„ç† | âœ… | å…¨å±€å¼‚å¸¸å¤„ç†å®Œå–„ |
| é…ç½®å¤–éƒ¨åŒ– | âœ… | ä½¿ç”¨ Nacos é…ç½®ä¸­å¿ƒ |
| ç™»å½•å¤±è´¥é™åˆ¶ | ğŸŸ¡ | åŸºäº Redis çš„è´¦å·é”å®šå·²ä¸Šçº¿ï¼Œç¼ºå°‘ IP/è®¾å¤‡ç»´åº¦é˜²æŠ¤ |
| ç™»å½•æ—¥å¿— | âŒ | **ç¼ºå¤±** |
| Token åˆ·æ–° | âŒ | **ç¼ºå¤±** |
| Token é»‘åå• | âŒ | **ç¼ºå¤±** |
| ç½‘å…³è®¤è¯ | âŒ | **ç¼ºå¤±** |
| é™æµä¿æŠ¤ | ğŸŸ¡ | **é”™è¯¯ç å·²å‡†å¤‡ï¼Œå®ç°ç¼ºå¤±** |
| Redis ç¼“å­˜ | ğŸŸ¡ | ç™»å½•å¤±è´¥è®¡æ•°å·²æ¥å…¥ï¼Œä¸šåŠ¡ç¼“å­˜ä¸ Token ç®¡ç†å¾…å®ç° |
| ç›‘æ§å‘Šè­¦ | âŒ | **ç¼ºå¤±** |

---

## ğŸ’¡ æ”¹è¿›ç¤ºä¾‹ä»£ç å»ºè®®

### 1. ç™»å½•å¤±è´¥æ¬¡æ•°é™åˆ¶ï¼ˆRedisï¼‰

```java
// ä½¿ç”¨ Redis è®°å½•ç™»å½•å¤±è´¥æ¬¡æ•°
String loginFailKey = "login:fail:" + username;
Integer failCount = redisTemplate.opsForValue().get(loginFailKey);
if (failCount != null && failCount >= MAX_LOGIN_FAIL_COUNT) {
    throw new BusinessException(ErrorCode.ACCOUNT_LOCKED);
}
```

### 2. ç™»å½•æ—¥å¿—è®°å½•ï¼ˆå¼‚æ­¥ï¼‰

```java
// å¼‚æ­¥è®°å½•ç™»å½•æ—¥å¿—
@Async
public void recordLoginLog(Long userId, String username, String ip, 
                          String userAgent, boolean success, String message) {
    SysUserLoginLog log = new SysUserLoginLog();
    log.setUserId(userId);
    log.setUsername(username);
    log.setLoginIp(ip);
    log.setUserAgent(userAgent);
    log.setLoginStatus(success ? 1 : 0);
    log.setLoginMessage(message);
    loginLogMapper.insert(log);
}
```

### 3. Token åˆ·æ–°æœºåˆ¶

```java
public LoginVo login(LoginDto dto) {
    // ... ç™»å½•éªŒè¯é€»è¾‘ ...
    
    // ç”Ÿæˆ Access Token å’Œ Refresh Token
    String accessToken = jwtUtil.generateAccessToken(user.getId());
    String refreshToken = jwtUtil.generateRefreshToken(user.getId());
    
    // å°† Refresh Token å­˜å…¥ Redis
    redisTemplate.opsForValue().set(
        "refresh:token:" + user.getId(), 
        refreshToken, 
        REFRESH_TOKEN_EXPIRE_TIME
    );
    
    LoginVo loginVo = new LoginVo();
    loginVo.setAccessToken(accessToken);
    loginVo.setRefreshToken(refreshToken);
    return loginVo;
}
```

### 4. ç½‘å…³ JWT éªŒè¯è¿‡æ»¤å™¨

```java
@Component
public class JwtAuthenticationFilter implements GatewayFilter {
    
    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        ServerHttpRequest request = exchange.getRequest();
        String token = getTokenFromRequest(request);
        
        if (token == null || !jwtUtil.validateToken(token)) {
            return unauthorizedResponse(exchange);
        }
        
        // éªŒè¯ Token é»‘åå•
        if (redisTemplate.hasKey("token:blacklist:" + token)) {
            return unauthorizedResponse(exchange);
        }
        
        return chain.filter(exchange);
    }
}
```

---

## ğŸ“ æ€»ç»“

### ä¼˜ç‚¹
- âœ… åŸºç¡€æ¶æ„è®¾è®¡åˆç†ï¼Œåˆ†å±‚æ¸…æ™°
- âœ… å®‰å…¨æ€§åŸºç¡€è‰¯å¥½ï¼ˆå¯†ç åŠ å¯†ã€JWTè®¤è¯ï¼‰
- âœ… ä»£ç è´¨é‡è¾ƒé«˜ï¼Œç¬¦åˆè§„èŒƒ

### æœ€æ–°å˜æ›´ï¼ˆæœ¬æ¬¡æ£€æŸ¥ï¼‰
1. âœ… **ç™»å½•å¤±è´¥é˜²æŠ¤ä¸Šçº¿**ï¼š`AuthServiceImpl` è”åŠ¨ `LoginSecurityService`ï¼ŒåŸºäº Redis è®°å½•å¤±è´¥æ¬¡æ•°å¹¶è‡ªåŠ¨é”å®šè´¦å·
2. âœ… **ç™»å½•å®‰å…¨é…ç½®æŠ½è±¡**ï¼šæ–°å¢ `LoginSecurityConfig`ï¼Œæ”¯æŒåœ¨ Nacos ä¸­åŠ¨æ€è°ƒæ•´æœ€å¤§å°è¯•æ¬¡æ•°ä¸é”å®šæ—¶é—´
3. âœ… **é”™è¯¯ç æ‰©å±•**ï¼šå·²å¢åŠ é™æµç›¸å…³é”™è¯¯ç ï¼ˆRATE_LIMIT_EXCEEDED, QUOTA_EXCEEDEDï¼‰

### éœ€è¦æ”¹è¿›
- ğŸŸ¡ **å®‰å…¨æ€§**ï¼šè´¦å·é”å®šå·²ä¸Šçº¿ï¼Œä½†ç¼ºå°‘ IP/è®¾å¤‡ç»´åº¦é˜²æŠ¤ã€éªŒè¯ç è”åŠ¨ã€ç™»å½•æ—¥å¿—ä¸ Token ç®¡ç†
- âŒ **ç½‘å…³å±‚**ï¼šç¼ºå°‘ç»Ÿä¸€è®¤è¯ä¸ç½‘å…³é™æµå®ç°
- âŒ **åŠŸèƒ½å®Œæ•´æ€§**ï¼šç¼ºå°‘ç™»å‡ºã€Token åˆ·æ–°
- âŒ **å¯è§‚æµ‹æ€§**ï¼šç¼ºå°‘ç™»å½•æ—¥å¿—è®°å½•å’Œç›‘æ§æŒ‡æ ‡
- ğŸŸ¡ **Redis ä½¿ç”¨**ï¼šå·²æœåŠ¡äºç™»å½•é˜²æŠ¤ï¼Œä»å¾…æ‰©å±• Token é»‘åå•ã€ç”¨æˆ·ç¼“å­˜ç­‰åœºæ™¯

### å»ºè®®
1. **ç«‹å³è¡¥å¼º** P0 ä¼˜å…ˆçº§èƒ½åŠ›ï¼ˆå®‰å…¨æ€§ç›¸å…³ï¼‰
   - æ‰©å±•ç™»å½•å¤±è´¥é˜²æŠ¤åˆ° IP/è®¾å¤‡ç»´åº¦ï¼Œç»“åˆéªŒè¯ç æˆ–äºŒæ¬¡è®¤è¯
   - å°½å¿«å®ç°ç™»å½•æˆåŠŸ/å¤±è´¥æ—¥å¿—è®°å½•ä¸å®¡è®¡
2. **å°½å¿«å®Œå–„** P1 ä¼˜å…ˆçº§åŠŸèƒ½ï¼ˆåŠŸèƒ½å®Œæ•´æ€§ï¼‰
   - å¼•å…¥ Refresh Tokenã€ç™»å‡ºä¸ Token é»‘åå•æœºåˆ¶
   - ç»Ÿä¸€ç½‘å…³å±‚é‰´æƒä¸é™æµç­–ç•¥
3. **åç»­ä¼˜åŒ–** P2 ä¼˜å…ˆçº§èƒ½åŠ›ï¼ˆæ€§èƒ½ä¸å¯è§‚æµ‹æ€§ï¼‰
   - å°† Redis åº”ç”¨äºç”¨æˆ·ä¿¡æ¯/Token ç¼“å­˜
   - æ„å»ºç™»å½•ç›‘æ§æŒ‡æ ‡ä¸å‘Šè­¦

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨
1. **è¡¥å……é£æ§ç»´åº¦**ï¼šå®ç° IP/è®¾å¤‡çº§å¤±è´¥è®¡æ•°ä¸æ»‘åŠ¨çª—å£é™æµ
2. **è½åœ°ç™»å½•æ—¥å¿—**ï¼šåˆ›å»ºæ—¥å¿—å®ä½“ã€Mapper åŠå¼‚æ­¥è®°å½•æµç¨‹
3. **è®¾è®¡ Token ç”Ÿå‘½å‘¨æœŸ**ï¼šå®ç° Refresh Tokenã€é»‘åå•åŠç™»å‡º
4. **å®Œå–„ç½‘å…³ç­–ç•¥**ï¼šåœ¨ç½‘å…³å¼•å…¥ JWT æ ¡éªŒä¸é™æµæ’ä»¶

---

**é¦–æ¬¡è¯„ä¼°æ—¥æœŸï¼š** 2025-11-08  
**æœ¬æ¬¡æ›´æ–°æ—¥æœŸï¼š** 2025-11-08  
**è¯„ä¼°äººï¼š** AI Assistant
